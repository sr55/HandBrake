$(eval $(call import.MODULE.rules,CLI))

build: CLI.build
install: CLI.install
install-strip: CLI.install-strip
uninstall: CLI.uninstall
clean: CLI.clean
xclean: CLI.xclean

CLI.build: $(CLI.exe)
ifeq (1,$(FEATURE.flatpak))
CLI.build: $(CLI.metainfo)
endif

########################################
# sync with ../macosx/module.rules     #
########################################
CLI.install-strip: | $(dir $(CLI.install.exe))
	$(CP.exe) $(CLI.exe) $(CLI.install.exe)
	$(STRIP.exe) $(CLI.install.exe)

ifeq (1,$(FEATURE.flatpak))
$(CLI.metainfo): $(CLI.metainfo.template)
	sed -e 's^RELEASE_TAG^<release version="$(HB.version)" date="$(word 1,$(HB.repo.date))" />^' $< > $@

$(CLI.install.metainfo): $(CLI.metainfo)
CLI.install: | $(dir $(CLI.install.metainfo))
endif

CLI.install: | $(dir $(CLI.install.exe))
	$(CP.exe) $(CLI.exe) $(CLI.install.exe)
ifeq (1,$(FEATURE.flatpak))
	$(CP.exe) $(CLI.metainfo) $(CLI.install.metainfo)
endif

CLI.uninstall:
	$(RM.exe) -f $(CLI.install.exe)

CLI.clean:
	$(RM.exe) -f $(CLI.out)

CLI.xclean: CLI.clean
########################################

$(CLI.exe): | $(dir $(CLI.exe))
$(CLI.exe): $(CLI.c.o)
	$(call CLI.GCC.EXE++,$@,$^ $(CLI.libs))
ifeq (none,$(FFMPEG.GCC.g))
ifeq (1-mingw,$(HOST.cross)-$(HOST.system))
	$(STRIP.exe) -s $(CLI.exe)
else
	$(STRIP.exe) $(CLI.exe)
endif
endif

$(CLI.c.o): $(LIBHB.a)
$(CLI.c.o): | $(dir $(CLI.c.o))
$(CLI.c.o): $(BUILD/)%.o: $(SRC/)%.c
	$(call CLI.GCC.C_O,$@,$<)
